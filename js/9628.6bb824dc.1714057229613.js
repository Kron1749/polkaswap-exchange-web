"use strict";(self.webpackChunkpolkaswap_exchange_web=self.webpackChunkpolkaswap_exchange_web||[]).push([[9628,4594],{54138:function(e,t,r){r.r(t),r.d(t,{default:function(){return g}});var s=r(23166),i=r(70655),o=r(99278),d=r(22620),n=r(89445),l=r(89334),a=r(49053),c=r(50961),h=r(21050);let u=class extends((0,n.Wr)(l.Z,d.tA.LoadingMixin,d.tA.FormattedAmountMixin)){constructor(...e){super(...e),(0,s.Z)(this,"userLimitOrders",void 0),(0,s.Z)(this,"currentOrderBook",void 0),(0,s.Z)(this,"subscribeOnLimitOrders",void 0),(0,s.Z)(this,"resetLimitOrdersSubscription",void 0),(0,s.Z)(this,"ordersToBeCancelled",void 0),(0,s.Z)(this,"setOrdersToBeCancelled",void 0),(0,s.Z)(this,"orderTable",void 0),(0,s.Z)(this,"currentPage",1),(0,s.Z)(this,"tableItems",[]),(0,s.Z)(this,"selectedPageItemIds",[]),(0,s.Z)(this,"needToUpdateSelection",!1),(0,s.Z)(this,"syncTableItemsRefreshing",!1)}get ordersToBeCancelledIds(){return this.ordersToBeCancelled.map((({id:e})=>e))}get loadingState(){return this.parentLoading||this.loading}get isSelectionAllowed(){return!!this.currentOrderBook&&this.currentOrderBook.status!==o.OrderBookStatus.Stop}get sortedUserLimitOrders(){return[...this.userLimitOrders].sort(((e,t)=>t.time-e.time))}async updatePagedOrdersSubscription(e,t){if(e?.length&&e.length!==t?.length){if(this.syncTableItemsRefreshing=!0,await(0,c.AE)((()=>!this.syncTableItemsRefreshing)),this.ordersToBeCancelledIds.length){const e=this.tableItems.filter((({id:e})=>this.ordersToBeCancelledIds.includes(e)));this.setOrdersToBeCancelled(e)}this.handlePagination(this.currentPage)}}async handlePagination(e,t){await this.withLoading((async()=>{const r=t??this.tableItems;this.currentPage=e,this.resetLimitOrdersSubscription(),r.length&&await this.subscribeOnLimitOrders(r.map((({id:e})=>e)))}))}restoreSelectedData(){const e=this.tableItems.filter((({id:e})=>this.ordersToBeCancelledIds.includes(e)));e.forEach((e=>{this.orderTable?.tableComponent?.toggleRowSelection?.(e,!0)})),this.selectedPageItemIds=e.map((({id:e})=>e))}handleSelect(e){this.needToUpdateSelection=!0}handleSelectRow(e){this.isSelectionAllowed&&(this.needToUpdateSelection=!0,this.orderTable?.tableComponent?.toggleRowSelection?.(e))}handleSelectionChange(e){if(!this.isSelectionAllowed||!this.needToUpdateSelection)return;const t=this.selectedPageItemIds.length-e.length;if(1===t){const t=e.map((({id:e})=>e)),r=this.selectedPageItemIds.find((e=>!t.includes(e)));r&&this.setOrdersToBeCancelled(this.ordersToBeCancelled.filter((({id:e})=>e!==r)))}else if(-1===t){const t=e.find((({id:e})=>!this.selectedPageItemIds.includes(e)));t&&this.setOrdersToBeCancelled([...this.ordersToBeCancelled,t])}this.selectedPageItemIds=e.map((({id:e})=>e)),this.needToUpdateSelection=!1}syncTableItems(e){this.tableItems=e,this.syncTableItemsRefreshing=!1,this.restoreSelectedData()}beforeDestroy(){this.isSelectionAllowed&&this.setOrdersToBeCancelled([]),this.resetLimitOrdersSubscription()}};(0,i.__decorate)([a.SB.orderBook.userLimitOrders],u.prototype,"userLimitOrders",void 0),(0,i.__decorate)([a.Yn.orderBook.currentOrderBook],u.prototype,"currentOrderBook",void 0),(0,i.__decorate)([a.aD.orderBook.subscribeOnLimitOrders],u.prototype,"subscribeOnLimitOrders",void 0),(0,i.__decorate)([a.QF.orderBook.resetPagedUserLimitOrdersSubscription],u.prototype,"resetLimitOrdersSubscription",void 0),(0,i.__decorate)([a.SB.orderBook.ordersToBeCancelled],u.prototype,"ordersToBeCancelled",void 0),(0,i.__decorate)([a.QF.orderBook.setOrdersToBeCancelled],u.prototype,"setOrdersToBeCancelled",void 0),(0,i.__decorate)([(0,n.Rl)("orderTable")],u.prototype,"orderTable",void 0),(0,i.__decorate)([(0,n.RL)("sortedUserLimitOrders",{deep:!0,immediate:!0})],u.prototype,"updatePagedOrdersSubscription",null),u=(0,i.__decorate)([(0,n.wA)({components:{OrderTable:h.default,HistoryPagination:d.wx.HistoryPagination}})],u);var p=u,g=(0,r(1001).Z)(p,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("order-table",{ref:"orderTable",attrs:{"is-open-orders":"",orders:e.sortedUserLimitOrders,selectable:e.isSelectionAllowed,"parent-loading":e.loadingState},on:{"cell-click":e.handleSelectRow,"selection-change":e.handleSelectionChange,select:e.handleSelect,"page-updated":e.handlePagination,sync:e.syncTableItems}})}),[],!1,null,null,null).exports}}]);
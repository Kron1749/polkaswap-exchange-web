"use strict";(self.webpackChunkpolkaswap_exchange_web=self.webpackChunkpolkaswap_exchange_web||[]).push([[7675],{67675:function(e,t,r){r.r(t),r.d(t,{default:function(){return m}});var o=r(23166),s=(r(70560),r(70655)),i=r(99278),a=r(36930),n=r(22620),d=r(89445),c=r(89334),l=r(68282),u=r(69781),h=r(49053);let p=class extends((0,d.Wr)(c.Z,n.tA.LoadingMixin,n.tA.FormattedAmountMixin)){constructor(...e){super(...e),(0,o.Z)(this,"limitOrderType",void 0),(0,o.Z)(this,"asks",void 0),(0,o.Z)(this,"bids",void 0),(0,o.Z)(this,"quoteAsset",void 0),(0,o.Z)(this,"orderBookLastDeal",void 0),(0,o.Z)(this,"currentOrderBook",void 0),(0,o.Z)(this,"orderBookId",void 0),(0,o.Z)(this,"nodeIsConnected",void 0),(0,o.Z)(this,"setQuoteValue",void 0),(0,o.Z)(this,"setSide",void 0),(0,o.Z)(this,"subscribeToBidsAndAsks",void 0),(0,o.Z)(this,"PriceVariant",i.PriceVariant),(0,o.Z)(this,"maxRowsNumber",11),(0,o.Z)(this,"selectedStep",""),(0,o.Z)(this,"scalerOpen",!1)}setSteps(){this.selectedStep=this.currentOrderBook?.tickSize.toString()}async updateSubscription(){await this.withLoading((async()=>{await this.withParentLoading((async()=>{await this.subscribeToBidsAndAsks()}))}))}handleSelectStep(e){this.selectedStep=e}fillPrice(e,t){this.isMarketOrder||(this.setSide(t),this.setQuoteValue(Number(e).toString()))}get isMarketOrder(){return this.limitOrderType===l.b8.market}get averagePrice(){return(this.asks?.[0]??this.bids?.[0])?.[0]}get averagePricePrecision(){if(!this.averagePrice)return;const e=this.averagePrice;let t=e,r=a.FPNumber.ONE;if(e.isLessThan(a.FPNumber.ONE)){const o=new a.FPNumber(.1);for(r=o;t.isLessThan(a.FPNumber.ONE)&&(t=e.div(r),!t.isGreaterThanOrEqualTo(a.FPNumber.ONE));)r=r.mul(o)}else if(e.isGreaterThan(a.FPNumber.TEN)){const o=a.FPNumber.TEN;for(r=o;t.isGreaterThan(a.FPNumber.ONE)&&(t=e.div(r),!t.isLessThan(a.FPNumber.TEN));)r=r.mul(o)}return r.toNumber()}get steps(){const e=[],t=this.currentOrderBook?.tickSize;if(!this.averagePricePrecision||!t)return e;for(let r=new a.FPNumber(this.averagePricePrecision??1);r.isGreaterThanOrEqualTo(t);)e.push(r.toString()),r=r.div(a.FPNumber.TEN);return e.slice(-6)}get showAggregationOptions(){return!(!this.asks?.length||!this.bids?.length)}get lastDealTrendsUp(){return this.orderBookLastDeal?.side===i.PriceVariant.Buy}get iconTrend(){return this.lastDealTrendsUp?"arrows-arrow-bold-top-24":"arrows-arrow-bold-bottom-24"}get lastDealPrice(){return this.orderBookLastDeal?.price??a.FPNumber.ZERO}get lastPriceFormatted(){return this.lastDealPrice.toLocaleString()}get fiatValue(){if(!this.quoteAsset)return l.m8;const e=this.getFiatAmount(this.lastDealPrice.toString(),this.quoteAsset);return e?`$${e}`:""}getComputedClassTrend(){const e=["stock-book-delimiter"];return this.lastDealTrendsUp?e.push("stock-book-delimiter--up"):e.push("stock-book-delimiter--down"),e.join(" ")}get asksFormatted(){return this.formatPriceVolumes(this.asks)}get bidsFormatted(){return this.formatPriceVolumes(this.bids)}get sellOrders(){return this.asksFormatted.slice(-this.maxRowsNumber)}get buyOrders(){return this.bidsFormatted.slice(0,this.maxRowsNumber)}getHeight(){return`height: ${24*(this.asksFormatted.length<this.maxRowsNumber?this.maxRowsNumber-this.asksFormatted.length:0)}px`}getStyles(e){return`width: ${e}%`}isBookPrecisionEqual(e){return e===this.currentOrderBook?.tickSize?.toString()}recalcFilledValue(e){if(!e.length)return[];const t=e.map((e=>new a.FPNumber(e.amount))),r=a.FPNumber.max(...t);return e.map((e=>({...e,filled:this.getAmountProportion(new a.FPNumber(e.amount),r)})))}calculateStepsDistribution(e,t=10){return e}get bookPrecision(){return this.currentOrderBook?.tickSize?.toLocaleString()?.split(a.FPNumber.DELIMITERS_CONFIG.decimal)[1]?.length||0}get amountPrecision(){return this.currentOrderBook?.stepLotSize?.toLocaleString()?.split(a.FPNumber.DELIMITERS_CONFIG.decimal)[1]?.length||0}getAmountProportion(e,t){return e.div(t).mul(a.FPNumber.HUNDRED).toNumber()}toBookPrecision(e){return e.toNumber().toFixed(this.bookPrecision)}toAmountPrecision(e){return e.toNumber().toFixed(this.amountPrecision)}formatPriceVolumes(e){if(!this.selectedStep)return[];const t=this.calculateStepsDistribution(e,Number(this.selectedStep)),r=a.FPNumber.max(...t.map((e=>e[1]))),o=[];return t.forEach((e=>{const[t,s,i]=e;if(s.isZero())return;const a=this.isBookPrecisionEqual(this.selectedStep)?t.mul(s):i;o.push({price:this.toBookPrecision(t),amount:this.toAmountPrecision(s),total:this.toBookPrecision(a),filled:this.getAmountProportion(s,r)})})),o}};(0,s.__decorate)([h.SB.orderBook.limitOrderType],p.prototype,"limitOrderType",void 0),(0,s.__decorate)([h.SB.orderBook.asks],p.prototype,"asks",void 0),(0,s.__decorate)([h.SB.orderBook.bids],p.prototype,"bids",void 0),(0,s.__decorate)([h.Yn.orderBook.quoteAsset],p.prototype,"quoteAsset",void 0),(0,s.__decorate)([h.Yn.orderBook.orderBookLastDeal],p.prototype,"orderBookLastDeal",void 0),(0,s.__decorate)([h.Yn.orderBook.currentOrderBook],p.prototype,"currentOrderBook",void 0),(0,s.__decorate)([h.Yn.orderBook.orderBookId],p.prototype,"orderBookId",void 0),(0,s.__decorate)([h.Yn.settings.nodeIsConnected],p.prototype,"nodeIsConnected",void 0),(0,s.__decorate)([h.QF.orderBook.setQuoteValue],p.prototype,"setQuoteValue",void 0),(0,s.__decorate)([h.QF.orderBook.setSide],p.prototype,"setSide",void 0),(0,s.__decorate)([h.aD.orderBook.subscribeToBidsAndAsks],p.prototype,"subscribeToBidsAndAsks",void 0),(0,s.__decorate)([(0,d.RL)("currentOrderBook",{immediate:!0})],p.prototype,"setSteps",null),(0,s.__decorate)([(0,d.RL)("orderBookId",{immediate:!0}),(0,d.RL)("nodeIsConnected")],p.prototype,"updateSubscription",null),p=(0,s.__decorate)([(0,d.wA)({components:{BaseWidget:(0,u.kF)(l.z8.BaseWidget)}})],p);var k=p,m=(0,r(1001).Z)(k,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("base-widget",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"stock-book book",attrs:{extensive:"",title:e.t("orderBook.orderBook"),tooltip:e.t("orderBook.tooltip.bookWidget")},scopedSlots:e._u([{key:"filters",fn:function(){return[e._e()]},proxy:!0}])},[t("div",{staticClass:"book-columns"},[t("div",[e._v(e._s(e.t("orderBook.price")))]),t("div",[e._v(e._s(e.t("orderBook.amount")))]),t("div",[e._v(e._s(e.t("orderBook.total")))])]),e.asksFormatted.length?t("div",{staticClass:"stock-book-sell",class:{unclickable:e.isMarketOrder}},[t("div",{staticClass:"margin",style:e.getHeight()}),e._l(e.sellOrders,(function(r){return t("div",{key:r.price,staticClass:"row",on:{click:function(t){return e.fillPrice(r.price,e.PriceVariant.Sell)}}},[t("span",{staticClass:"order-info total"},[e._v(e._s(r.total))]),t("span",{staticClass:"order-info amount"},[e._v(e._s(r.amount))]),t("span",{staticClass:"order-info price"},[e._v(e._s(r.price))]),t("div",{staticClass:"bar",style:e.getStyles(r.filled)})])}))],2):t("div",{staticClass:"stock-book-sell--no-asks"},[e._v(e._s(e.t("orderBook.book.noAsks")))]),t("div",{class:e.getComputedClassTrend()},[t("div",[t("span",{staticClass:"mark-price"},[e._v(e._s(e.lastPriceFormatted))]),t("s-icon",{staticClass:"trend-icon",attrs:{name:e.iconTrend,size:"18"}}),t("span",{staticClass:"last-traded-price"},[e._v(e._s(e.fiatValue))])],1)]),e.bidsFormatted.length?t("div",{staticClass:"stock-book-buy",class:{unclickable:e.isMarketOrder}},e._l(e.buyOrders,(function(r){return t("div",{key:r.price,staticClass:"row",on:{click:function(t){return e.fillPrice(r.price,e.PriceVariant.Buy)}}},[t("span",{staticClass:"order-info total"},[e._v(e._s(r.total))]),t("span",{staticClass:"order-info amount"},[e._v(e._s(r.amount))]),t("span",{staticClass:"order-info price"},[e._v(e._s(r.price))]),t("div",{staticClass:"bar",style:e.getStyles(r.filled)})])})),0):t("div",{staticClass:"stock-book-buy--no-bids"},[e._v(e._s(e.t("orderBook.book.noBids")))])])}),[],!1,null,null,null).exports}}]);